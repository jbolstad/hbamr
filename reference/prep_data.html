<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prepare data to fit an HBAM or FBAM model — prep_data • hbamr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare data to fit an HBAM or FBAM model — prep_data"><meta name="description" content="This function prepares data to fit a hierarchical Bayesian Aldrich-McKelvey (HBAM) model. It can be run ahead of fitting the models, or it can be run implicitly as part of a single function call to fit the models using hbam() or fbam(). It applies a set of inclusion criteria, performs any necessary data transformation, and returns a list of data suited for sampling in rstan. The data provided to prep_data() can be centered, but they do not have to be: The function will detect un-centered data and attempt to center these automatically, assuming that the highest and lowest observed values in the data mark the extremes of the scale."><meta property="og:description" content="This function prepares data to fit a hierarchical Bayesian Aldrich-McKelvey (HBAM) model. It can be run ahead of fitting the models, or it can be run implicitly as part of a single function call to fit the models using hbam() or fbam(). It applies a set of inclusion criteria, performs any necessary data transformation, and returns a list of data suited for sampling in rstan. The data provided to prep_data() can be centered, but they do not have to be: The function will detect un-centered data and attempt to center these automatically, assuming that the highest and lowest observed values in the data mark the extremes of the scale."><meta property="og:image" content="https://jbolstad.github.io/hbamr/logo.png"><meta name="google-site-verification" content="69MLv6UCy5t-k76w3j9fryUEcyWbdOd5t5QpYCoctoM"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hbamr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.4.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hbamr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jbolstad/hbamr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Prepare data to fit an HBAM or FBAM model</h1>
      <small class="dont-index">Source: <a href="https://github.com/jbolstad/hbamr/blob/main/R/prep_data.R" class="external-link"><code>R/prep_data.R</code></a></small>
      <div class="d-none name"><code>prep_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function prepares data to fit a hierarchical Bayesian Aldrich-McKelvey (HBAM) model. It can be run ahead of fitting the models, or it can be run implicitly as part of a single function call to fit the models using <code><a href="hbam.html">hbam()</a></code> or <code><a href="fbam.html">fbam()</a></code>. It applies a set of inclusion criteria, performs any necessary data transformation, and returns a list of data suited for sampling in <code>rstan</code>. The data provided to <code>prep_data()</code> can be centered, but they do not have to be: The function will detect un-centered data and attempt to center these automatically, assuming that the highest and lowest observed values in the data mark the extremes of the scale.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prep_data</span><span class="op">(</span></span>
<span>  self <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">stimuli</span>,</span>
<span>  prefs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  allow_miss <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  req_valid <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  req_unique <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  B <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-self">self<a class="anchor" aria-label="anchor" href="#arg-self"></a></dt>
<dd><p>An optional numerical vector of N ideological self-placements. Any missing data must be coded as NA. If this argument is not supplied, respondent positions will not be estimated.</p></dd>


<dt id="arg-stimuli">stimuli<a class="anchor" aria-label="anchor" href="#arg-stimuli"></a></dt>
<dd><p>An N × J matrix of numerical stimulus placements, where J is the number of stimuli. Any missing data must be coded as NA.</p></dd>


<dt id="arg-prefs">prefs<a class="anchor" aria-label="anchor" href="#arg-prefs"></a></dt>
<dd><p>An N × J matrix of numerical stimulus ratings or preference scores. These data are only required by the <code>"HBAM_R_MINI"</code> model and will be ignored when fitting other models.</p></dd>


<dt id="arg-allow-miss">allow_miss<a class="anchor" aria-label="anchor" href="#arg-allow-miss"></a></dt>
<dd><p>Integer specifying how many missing stimulus positions should be accepted for an individual still to be included in the analysis. Defaults to 2.</p></dd>


<dt id="arg-req-valid">req_valid<a class="anchor" aria-label="anchor" href="#arg-req-valid"></a></dt>
<dd><p>Integer specifying how many valid observations to require for a respondent to be included in the analysis. The default is <code>req_valid = J - allow_miss</code>, but if specified, <code>req_valid</code> takes precedence.</p></dd>


<dt id="arg-req-unique">req_unique<a class="anchor" aria-label="anchor" href="#arg-req-unique"></a></dt>
<dd><p>Integer specifying how may unique positions on the ideological scale each respondent is required to have used when placing the stimuli in order to be included in the analysis. The default is <code>req_unique = 2</code>.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Scalar specifying the upper bound of the survey scale after centering. If not supplied, this information will be inferred from the data.</p></dd>


<dt id="arg-group-id">group_id<a class="anchor" aria-label="anchor" href="#arg-group-id"></a></dt>
<dd><p>Vector of length N identifying which group each respondent belongs to. The format can be factor, character, integer, or numeric. Respondents with NAs on <code>group_id</code> will be dropped when <code>group_id</code> is supplied. These data are only required by models with <code>"MULTI"</code> in their name and will be ignored when fitting other models.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical: Should information about the data be printed to the console? Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of data to be used by <code><a href="hbam.html">hbam()</a></code> or <code><a href="fbam.html">fbam()</a></code>. The returned list includes the logical vector <code>keep</code>, which identifies the rows in the original data that have been kept for further analysis. The stimuli data are stored in a vector as a long-form sparse matrix. If the stimuli data include column-names, these will be preserved for later use.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Loading and re-coding ANES 1980 data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">LC1980</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">LC1980</span><span class="op">[</span><span class="va">LC1980</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">LC1980</span> <span class="op">==</span> <span class="fl">8</span> <span class="op">|</span> <span class="va">LC1980</span> <span class="op">==</span> <span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">self</span> <span class="op">&lt;-</span> <span class="va">LC1980</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">stimuli</span> <span class="op">&lt;-</span> <span class="va">LC1980</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare data for model fitting, using defaults:</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">prep_data</span><span class="op">(</span><span class="va">self</span>, <span class="va">stimuli</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of prepared data (values for supplied data in paretheses)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Number of respondents: 881 (888)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Number of stimuli: 6 (6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Number of stimuli obs.: 4937 (4973)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Range of observations: [-3, 3] ([1, 7])</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare data for model fitting, using using alternative settings:</span></span></span>
<span class="r-in"><span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu">prep_data</span><span class="op">(</span><span class="va">self</span>, <span class="va">stimuli</span>, allow_miss <span class="op">=</span> <span class="fl">0</span>, req_unique <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of prepared data (values for supplied data in paretheses)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Number of respondents: 603 (888)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Number of stimuli: 6 (6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Number of stimuli obs.: 3618 (4973)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Range of observations: [-3, 3] ([1, 7])</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtain the data that are included in the analysis:</span></span></span>
<span class="r-in"><span><span class="va">self2</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">[</span><span class="va">dat2</span><span class="op">$</span><span class="va">keep</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">stimuli2</span> <span class="op">&lt;-</span> <span class="va">stimuli</span><span class="op">[</span><span class="va">dat2</span><span class="op">$</span><span class="va">keep</span>, <span class="op">]</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jørgen Bølstad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

